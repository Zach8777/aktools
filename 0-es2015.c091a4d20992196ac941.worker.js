!function(t){var e={};function a(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,(function(e){return t[e]}).bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s="QKe9")}({QKe9:function(t,e){let a=[],n=[{number:5,hash:[6,3,0,0,1,1,0,0,6,1,0,0,0,0,0,0,6,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,6,1,0,0,2,3,1,0,1,0,0,0,4,6,6,0,0,0,0,0,0,5,6,2,0,0,0,0,0,6,6,0,1,0,0,0,5,6,6,0,6,4,1,1,0,0,0,0],count:6},{number:4,hash:[0,0,0,11,13,5,0,0,0,0,11,13,5,0,0,0,0,3,13,8,0,0,0,0,3,12,13,1,10,10,0,0,13,11,0,0,13,13,0,0,13,2,0,0,12,13,0,0,1,0,0,3,6,2,0,0,0,0,1,3,13,13,0,0,0,0,0,0,12,13,0,0,0,0,0,0,12,13,0,0],count:13},{number:0,hash:[7,9,8,2,0,0,0,0,9,5,0,1,9,8,2,0,7,0,0,0,2,8,6,0,3,0,0,0,2,7,6,1,2,0,0,0,2,7,8,2,1,0,0,0,1,7,8,2,3,0,0,0,1,9,8,2,5,0,0,0,2,8,6,0,8,4,1,0,6,8,2,0,5,9,7,3,0,0,0,0],count:9},{number:3,hash:[8,6,4,1,0,0,0,0,4,0,0,0,8,8,2,0,0,0,0,0,5,9,4,0,0,0,0,2,9,7,3,0,3,9,9,2,1,0,0,0,0,6,8,5,7,4,1,0,0,0,0,0,3,8,7,4,0,0,0,0,1,5,8,4,0,0,0,2,5,8,6,2,9,6,4,2,1,0,0,0],count:9},{number:1,hash:[11,8,6,3,0,0,0,0,10,4,10,4,1,1,0,0,0,1,7,10,1,1,0,0,0,0,6,10,0,1,1,0,0,0,6,10,1,1,1,0,1,1,7,10,0,0,1,0,0,1,8,7,0,1,1,0,0,1,8,7,1,1,0,0,1,2,9,8,1,1,0,0,2,1,1,0,0,1,1,0],count:12},{number:2,hash:[9,7,5,1,0,0,0,0,1,0,0,0,8,9,3,0,0,0,0,0,5,9,4,0,0,0,0,0,5,9,4,0,0,0,0,0,9,9,3,0,0,0,0,6,9,4,0,0,0,2,8,9,2,0,0,0,4,9,8,1,0,0,0,0,9,7,1,0,0,1,1,0,1,0,0,0,0,0,0,0],count:9},{number:6,hash:[2,5,5,4,0,0,0,0,5,4,0,0,0,4,4,0,4,0,0,0,0,0,0,0,1,0,0,2,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,3,5,3,0,0,0,0,0,0,5,5,1,4,0,0,0,0,5,5,1,5,0,0,0,3,5,4,0,5,5,5,2,1,1,0,0],count:5},{number:7,hash:[3,1,0,0,0,0,0,0,1,0,0,0,3,3,1,0,1,0,0,0,3,3,0,0,1,0,0,1,3,0,0,0,1,0,1,3,1,0,0,0,1,0,3,3,1,1,1,0,0,0,3,3,0,1,1,0,0,0,3,2,0,1,1,0,0,0,3,2,1,1,1,0,1,1,3,2,0,0,0,0],count:4},{number:8,hash:[5,6,6,1,0,0,0,0,6,3,0,0,4,6,3,0,5,0,0,0,0,6,5,0,6,3,0,0,2,6,4,0,6,6,3,0,1,1,0,0,6,5,0,0,6,2,0,0,4,0,0,0,3,6,6,1,0,0,0,0,0,5,6,2,3,0,0,0,2,6,6,1,6,6,4,0,1,0,0,0],count:6},{number:9,hash:[6,6,2,0,0,0,0,0,4,0,0,1,6,5,1,0,0,0,0,0,3,6,3,0,0,0,0,0,0,6,6,0,2,0,0,0,5,6,6,0,6,5,0,0,1,3,4,0,1,0,1,1,1,6,6,0,1,0,0,0,4,6,3,0,4,1,1,1,5,5,0,0,5,5,2,1,0,0,0,0],count:6}];for(let c of n)c.hash instanceof Array&&(c.hash=c.hash.map(t=>t/c.count).map(t=>.5==t?2:t<.5?0:1).join(""));for(let c of a)c.hash instanceof Array&&(c.hash=c.hash.map(t=>t/c.count).map(t=>.5==t?2:t<.5?0:1).join(""));let o,h,r=[{R:[225,255],G:[175,205],B:[0,10]},{R:[208,222],G:[185,205],B:[208,222]},{R:[0,5],G:[170,190],B:[240,255]},{R:[215,245],G:[225,240],B:[50,60]},{R:[0,10],G:[0,4],B:[0,4]},{R:[200,220],G:[165,179],B:[0,4]}],s=[[]],l=[[]],u=[],d=[],g=[];addEventListener("message",t=>{switch(t.data.method){case"LoadHashData":a=t.data.Data;for(let t of a)t.hash instanceof Array&&(t.hash=t.hash.map(e=>e/t.count).map(t=>.5==t?2:t<.5?0:1).join(""));break;case"ImageDataLoad":postMessage({text:"\u56fe\u50cf\u6570\u636e\u9884\u5904\u7406 - \u8fb9\u754c\u8bc6\u522b",progress:.1}),o=new Uint16Array(t.data.data.width),h=new Uint16Array(t.data.data.height),s=[[]],l=[[]],u=[],d=[],function(t){for(let e=0;e<t.data.length;e+=4){const a=t.data[e],n=t.data[e+1],s=t.data[e+2],l=Math.floor(e/4)%t.width,u=Math.floor(Math.floor(e/4)/t.width);r.some(t=>t.R[0]<=a&&t.R[1]>=a&&t.G[0]<=n&&t.G[1]>=n&&t.B[0]<=s&&t.B[1]>=s)&&(o[l]++,h[u]++)}}(t.data.data),postMessage({method:"status",text:"\u5206\u6790\u56fe\u50cf\u8fb9\u754c",progress:.2}),function(){for(let a=0,n=0,h=0;a<o.length;a++)o[a]>8?(0==s[s.length-1].length&&(s[s.length-1][0]=a,n=0),h=a,n=0):o[a]>2&&o[a]<=8?(o[a-1]>8||o[a+1]>8)&&(0==s[s.length-1].length&&(s[s.length-1][0]=a,n=0),h=a,n=0):1==s[s.length-1].length&&n>=10?(s[s.length-1][1]=h,s.push([]),n=0):1==s[s.length-1].length&&n++;1==s[s.length-1].length&&Math.abs(o.length-1-s[s.length-1][0]-(s[s.length-2][1]-s[s.length-2][0]))<5?s[s.length-1][1]=o.length-1:s.pop();let t=[];for(let a=0;a<s.length;a++)t.push(s[a][1]-s[a][0]);let e=Math.round(t.reduce((t,e)=>t+e)/t.length);for(let a=0;a<s.length;a++)s[a][1]-s[a][0]<50?(s.splice(a,1),a--):Math.abs(s[a][1]-s[a][0]-e)>20&&(s[a][1]=s[a][0]+Math.max(...t));for(let a=0,n=0,o=0;a<h.length;a++)h[a]>8?(0==l[l.length-1].length&&(l[l.length-1][0]=a,n=0),o=a):1==l[l.length-1].length&&n>=10?(l[l.length-1][1]=o,l.push([]),n=0):1==l[l.length-1].length&&n++;1==l[l.length-1].length?l[l.length-1][1]=h.length-1:l.pop();for(let a=0;a<l.length;a++)l[a][1]-l[a][0]<50&&(l.splice(a,1),a--)}(),postMessage({method:"status",text:"\u4e3b\u7ebf\u7a0b\u5207\u56fe(\u9875\u9762\u53ef\u80fd\u6682\u65f6\u5361\u6b7b)",progress:.35}),postMessage({method:"clipImage",XBound:s,YBound:l});break;case"calcDhash":u=t.data.ImageDatas.map(t=>{let e="";for(let a=0;a<t.data.length;a+=4)Math.floor(a/4)%t.width!=0&&(Math.floor((t.data[a-4]+t.data[a-3]+t.data[a-2])/3)>Math.floor((t.data[a]+t.data[a+1]+t.data[a+2])/3)?e+=1:e+=0);return e}),g=[...u],postMessage({method:"status",text:"\u6b63\u5728\u5224\u65ad\u56fe\u50cf\u5bf9\u5e94\u7684\u7269\u54c1",progress:.45}),u=u.map(t=>{const e=a.map(e=>{let a=0,n=144;for(let o=0;o<t.length;o++)t[o]==e.hash[o]&&a++,2==e.hash[o]&&n--;return a/=n,e.confidence=a,e}).sort((t,e)=>e.confidence-t.confidence);return e[0].confidence<=.75&&e.unshift({id:"0000",hash:"",count:0,confidence:1}),e}),postMessage({method:"status",text:"\u4e3b\u7ebf\u7a0b\u5207\u5272\u6570\u5b57(\u9875\u9762\u53ef\u80fd\u6682\u65f6\u5361\u6b7b)",progress:.57}),postMessage({method:"getNumberData"});break;case"getItemCount":postMessage({method:"status",text:"\u6b63\u5728\u8bc6\u522b\u7269\u54c1\u6570\u91cf",progress:.6}),d=t.data.ImageDatas.map(t=>t.map(t=>{let e="";for(let a=0;a<t.data.length;a+=4)Math.floor(a/4)%t.width!=0&&(Math.floor((t.data[a-4]+t.data[a-3]+t.data[a-2])/3)>Math.floor((t.data[a]+t.data[a+1]+t.data[a+2])/3)?e+=1:e+=0);return e}));let e=d.map(t=>Number(t.map(t=>{let e=n.map(e=>{let a=0,n=80;for(let o=0;o<t.length;o++)t[o]==e.hash[o]&&a++,2==e.hash[o]&&n--;return a/=n,e.confidence=a,e}).sort((t,e)=>e.confidence-t.confidence);return e[0].confidence>.75?e[0].number:null}).join("")));postMessage({method:"status",text:"\u8bc6\u522b\u5b8c\u6210\uff0c\u70b9\u51fb\u4e0b\u65b9\u7269\u54c1\u53ef\u4ee5\u8fdb\u884c\u4fee\u6539\u3002",progress:1}),postMessage({method:"DetectResult",NumberResult:e,Items:u});break;case"getItemHashs":postMessage({method:"SingleItemHash",Item:u[t.data.index],OriginHash:g[t.data.index]})}})}});