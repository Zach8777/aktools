function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}!function(t){var e={};function n(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(a,r,(function(e){return t[e]}).bind(null,r));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="QKe9")}({QKe9:function(t,e){for(var n=[],a=[{number:5,hash:[6,3,0,0,1,1,0,0,6,1,0,0,0,0,0,0,6,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,6,1,0,0,2,3,1,0,1,0,0,0,4,6,6,0,0,0,0,0,0,5,6,2,0,0,0,0,0,6,6,0,1,0,0,0,5,6,6,0,6,4,1,1,0,0,0,0],count:6},{number:4,hash:[0,0,0,11,13,5,0,0,0,0,11,13,5,0,0,0,0,3,13,8,0,0,0,0,3,12,13,1,10,10,0,0,13,11,0,0,13,13,0,0,13,2,0,0,12,13,0,0,1,0,0,3,6,2,0,0,0,0,1,3,13,13,0,0,0,0,0,0,12,13,0,0,0,0,0,0,12,13,0,0],count:13},{number:0,hash:[7,9,8,2,0,0,0,0,9,5,0,1,9,8,2,0,7,0,0,0,2,8,6,0,3,0,0,0,2,7,6,1,2,0,0,0,2,7,8,2,1,0,0,0,1,7,8,2,3,0,0,0,1,9,8,2,5,0,0,0,2,8,6,0,8,4,1,0,6,8,2,0,5,9,7,3,0,0,0,0],count:9},{number:3,hash:[8,6,4,1,0,0,0,0,4,0,0,0,8,8,2,0,0,0,0,0,5,9,4,0,0,0,0,2,9,7,3,0,3,9,9,2,1,0,0,0,0,6,8,5,7,4,1,0,0,0,0,0,3,8,7,4,0,0,0,0,1,5,8,4,0,0,0,2,5,8,6,2,9,6,4,2,1,0,0,0],count:9},{number:1,hash:[11,8,6,3,0,0,0,0,10,4,10,4,1,1,0,0,0,1,7,10,1,1,0,0,0,0,6,10,0,1,1,0,0,0,6,10,1,1,1,0,1,1,7,10,0,0,1,0,0,1,8,7,0,1,1,0,0,1,8,7,1,1,0,0,1,2,9,8,1,1,0,0,2,1,1,0,0,1,1,0],count:12},{number:2,hash:[9,7,5,1,0,0,0,0,1,0,0,0,8,9,3,0,0,0,0,0,5,9,4,0,0,0,0,0,5,9,4,0,0,0,0,0,9,9,3,0,0,0,0,6,9,4,0,0,0,2,8,9,2,0,0,0,4,9,8,1,0,0,0,0,9,7,1,0,0,1,1,0,1,0,0,0,0,0,0,0],count:9},{number:6,hash:[2,5,5,4,0,0,0,0,5,4,0,0,0,4,4,0,4,0,0,0,0,0,0,0,1,0,0,2,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,3,5,3,0,0,0,0,0,0,5,5,1,4,0,0,0,0,5,5,1,5,0,0,0,3,5,4,0,5,5,5,2,1,1,0,0],count:5},{number:7,hash:[3,1,0,0,0,0,0,0,1,0,0,0,3,3,1,0,1,0,0,0,3,3,0,0,1,0,0,1,3,0,0,0,1,0,1,3,1,0,0,0,1,0,3,3,1,1,1,0,0,0,3,3,0,1,1,0,0,0,3,2,0,1,1,0,0,0,3,2,1,1,1,0,1,1,3,2,0,0,0,0],count:4},{number:8,hash:[5,6,6,1,0,0,0,0,6,3,0,0,4,6,3,0,5,0,0,0,0,6,5,0,6,3,0,0,2,6,4,0,6,6,3,0,1,1,0,0,6,5,0,0,6,2,0,0,4,0,0,0,3,6,6,1,0,0,0,0,0,5,6,2,3,0,0,0,2,6,6,1,6,6,4,0,1,0,0,0],count:6},{number:9,hash:[6,6,2,0,0,0,0,0,4,0,0,1,6,5,1,0,0,0,0,0,3,6,3,0,0,0,0,0,0,6,6,0,2,0,0,0,5,6,6,0,6,5,0,0,1,3,4,0,1,0,1,1,1,6,6,0,1,0,0,0,4,6,3,0,4,1,1,1,5,5,0,0,5,5,2,1,0,0,0,0],count:6}],r=function(){var t=h[o];t.hash instanceof Array&&(t.hash=t.hash.map((function(e){return e/t.count})).map((function(t){return.5==t?2:t<.5?0:1})).join(""))},o=0,h=a;o<h.length;o++)r();var u=!0,s=!1,l=void 0;try{for(var i,c=function(){var t=i.value;t.hash instanceof Array&&(t.hash=t.hash.map((function(e){return e/t.count})).map((function(t){return.5==t?2:t<.5?0:1})).join(""))},f=n[Symbol.iterator]();!(u=(i=f.next()).done);u=!0)c()}catch(M){s=!0,l=M}finally{try{u||null==f.return||f.return()}finally{if(s)throw l}}var d,g,p=[{R:[225,255],G:[175,205],B:[0,10]},{R:[208,222],G:[185,205],B:[208,222]},{R:[0,5],G:[170,190],B:[240,255]},{R:[215,245],G:[225,240],B:[50,60]},{R:[0,10],G:[0,4],B:[0,4]},{R:[200,220],G:[165,179],B:[0,4]}],m=[[]],b=[[]],y=[],v=[];addEventListener("message",(function(t){switch(t.data.method){case"LoadHashData":n=t.data.Data;var e=!0,r=!1,o=void 0;try{for(var h,u=function(){var t=h.value;t.hash instanceof Array&&(t.hash=t.hash.map((function(e){return e/t.count})).map((function(t){return.5==t?2:t<.5?0:1})).join(""))},s=n[Symbol.iterator]();!(e=(h=s.next()).done);e=!0)u()}catch(M){r=!0,o=M}finally{try{e||null==s.return||s.return()}finally{if(r)throw o}}break;case"ImageDataLoad":postMessage({text:"\u56fe\u50cf\u6570\u636e\u9884\u5904\u7406 - \u8fb9\u754c\u8bc6\u522b",progress:.1}),d=new Uint16Array(t.data.data.width),g=new Uint16Array(t.data.data.height),m=[[]],b=[[]],y=[],[],function(t){for(var e=function(e){var n=t.data[e],a=t.data[e+1],r=t.data[e+2],o=Math.floor(e/4)%t.width,h=Math.floor(Math.floor(e/4)/t.width);p.some((function(t){return t.R[0]<=n&&t.R[1]>=n&&t.G[0]<=a&&t.G[1]>=a&&t.B[0]<=r&&t.B[1]>=r}))&&(d[o]++,g[h]++)},n=0;n<t.data.length;n+=4)e(n)}(t.data.data),postMessage({method:"status",text:"\u5206\u6790\u56fe\u50cf\u8fb9\u754c",progress:.2}),function(){for(var t=0,e=0,n=0;t<d.length;t++)d[t]>8?(0==m[m.length-1].length&&(m[m.length-1][0]=t,e=0),n=t,e=0):d[t]>2&&d[t]<=8?(d[t-1]>8||d[t+1]>8)&&(0==m[m.length-1].length&&(m[m.length-1][0]=t,e=0),n=t,e=0):1==m[m.length-1].length&&e>=10?(m[m.length-1][1]=n,m.push([]),e=0):1==m[m.length-1].length&&e++;1==m[m.length-1].length&&Math.abs(d.length-1-m[m.length-1][0]-(m[m.length-2][1]-m[m.length-2][0]))<5?m[m.length-1][1]=d.length-1:m.pop();for(var a=[],r=0;r<m.length;r++)a.push(m[r][1]-m[r][0]);for(var o=Math.round(a.reduce((function(t,e){return t+e}))/a.length),h=0;h<m.length;h++)m[h][1]-m[h][0]<50?(m.splice(h,1),h--):Math.abs(m[h][1]-m[h][0]-o)>20&&(m[h][1]=m[h][0]+Math.max.apply(Math,a));for(var u=0,s=0,l=0;u<g.length;u++)g[u]>8?(0==b[b.length-1].length&&(b[b.length-1][0]=u,s=0),l=u):1==b[b.length-1].length&&s>=10?(b[b.length-1][1]=l,b.push([]),s=0):1==b[b.length-1].length&&s++;1==b[b.length-1].length?b[b.length-1][1]=g.length-1:b.pop();for(var i=0;i<b.length;i++)b[i][1]-b[i][0]<50&&(b.splice(i,1),i--)}(),postMessage({method:"status",text:"\u4e3b\u7ebf\u7a0b\u5207\u56fe(\u9875\u9762\u53ef\u80fd\u6682\u65f6\u5361\u6b7b)",progress:.35}),postMessage({method:"clipImage",XBound:m,YBound:b});break;case"calcDhash":y=t.data.ImageDatas.map((function(t){for(var e="",n=0;n<t.data.length;n+=4)Math.floor(n/4)%t.width!=0&&(Math.floor((t.data[n-4]+t.data[n-3]+t.data[n-2])/3)>Math.floor((t.data[n]+t.data[n+1]+t.data[n+2])/3)?e+=1:e+=0);return e})),v=_toConsumableArray(y),postMessage({method:"status",text:"\u6b63\u5728\u5224\u65ad\u56fe\u50cf\u5bf9\u5e94\u7684\u7269\u54c1",progress:.45}),y=y.map((function(t){var e=n.map((function(e){for(var n=0,a=144,r=0;r<t.length;r++)t[r]==e.hash[r]&&n++,2==e.hash[r]&&a--;return n/=a,e.confidence=n,e})).sort((function(t,e){return e.confidence-t.confidence}));return e[0].confidence<=.75&&e.unshift({id:"0000",hash:"",count:0,confidence:1}),e})),postMessage({method:"status",text:"\u4e3b\u7ebf\u7a0b\u5207\u5272\u6570\u5b57(\u9875\u9762\u53ef\u80fd\u6682\u65f6\u5361\u6b7b)",progress:.57}),postMessage({method:"getNumberData"});break;case"getItemCount":postMessage({method:"status",text:"\u6b63\u5728\u8bc6\u522b\u7269\u54c1\u6570\u91cf",progress:.6});var l=t.data.ImageDatas.map((function(t){return t.map((function(t){for(var e="",n=0;n<t.data.length;n+=4)Math.floor(n/4)%t.width!=0&&(Math.floor((t.data[n-4]+t.data[n-3]+t.data[n-2])/3)>Math.floor((t.data[n]+t.data[n+1]+t.data[n+2])/3)?e+=1:e+=0);return e}))})).map((function(t){return Number(t.map((function(t){var e=a.map((function(e){for(var n=0,a=80,r=0;r<t.length;r++)t[r]==e.hash[r]&&n++,2==e.hash[r]&&a--;return n/=a,e.confidence=n,e})).sort((function(t,e){return e.confidence-t.confidence}));return e[0].confidence>.75?e[0].number:null})).join(""))}));postMessage({method:"status",text:"\u8bc6\u522b\u5b8c\u6210\uff0c\u70b9\u51fb\u4e0b\u65b9\u7269\u54c1\u53ef\u4ee5\u8fdb\u884c\u4fee\u6539\u3002",progress:1}),postMessage({method:"DetectResult",NumberResult:l,Items:y});break;case"getItemHashs":postMessage({method:"SingleItemHash",Item:y[t.data.index],OriginHash:v[t.data.index]})}}))}});